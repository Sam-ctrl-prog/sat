<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>StudyPro</title>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/tailwindcss/2.2.19/tailwind.min.css" rel="stylesheet">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/feather-icons/4.29.0/feather.min.js"></script>
  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
  ="w-full max-w-md">
      <div class="bg-white rounded-xl shadow-xl overflow-hidden p-8">
        <div class="text-center mb-8">
          <h1 class="text-3xl font-bold text-blue-600">StudyPro</h1>
          <p class="text-gray-600 mt-2">Create your account</p>
        </div>
        
        <div id="signup-error" class="hidden bg-red-100 text-red-800 p-3 rounded-lg mb-4"></div>
        
        <style>
    .dark {
      background-color: #1a202c;
      color: #e2e8f0;
    }
    
    .dark .bg-dark {
      background-color: #2d3748;
    }
    
    .dark .border-dark {
      border-color: #4a5568;
    }
    
    .dark .text-dark {
      color: #e2e8f0;
    }
    
    .dark .bg-input-dark {
      background-color: #4a5568;
    }
    
    .transform-scale:hover {
      transform: scale(1.05);
    }
    
    .transition-all {
      transition: all 0.3s ease;
    }

    .chat-message {
      transition: all 0.3s ease;
      animation: fadeIn 0.5s;
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }

    .loading-dots:after {
      content: '.';
      animation: dots 1.5s steps(5, end) infinite;
    }

    @keyframes dots {
      0%, 20% { content: '.'; }
      40% { content: '..'; }
      60% { content: '...'; }
      80%, 100% { content: ''; }
    }
  </style>
</head>
<body class="min-h-screen flex flex-col bg-gray-100 text-gray-800">
  <!-- Auth Container (Sign In) -->
  <div id="auth-signin" class="min-h-screen flex items-center justify-center bg-gradient-to-br from-blue-50 to-indigo-100">
    <div class="w-full max-w-md">
      <div class="bg-white rounded-xl shadow-xl overflow-hidden p-8">
        <div class="text-center mb-8">
          <h1 class="text-3xl font-bold text-blue-600">StudyPro</h1>
          <p class="text-gray-600 mt-2">Sign in to continue your learning journey</p>
        </div>
        
        <div id="auth-error" class="hidden bg-red-100 text-red-800 p-3 rounded-lg mb-4"></div>
        
        <form id="signin-form" class="space-y-4">
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-1">Email</label>
            <input 
              type="email" 
              name="email" 
              class="w-full px-4 py-2 rounded-lg border border-gray-300 bg-white text-gray-800 focus:outline-none focus:ring-2 focus:ring-blue-500"
              required
            />
          </div>
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-1">Password</label>
            <input 
              type="password" 
              name="password" 
              class="w-full px-4 py-2 rounded-lg border border-gray-300 bg-white text-gray-800 focus:outline-none focus:ring-2 focus:ring-blue-500"
              required
            />
          </div>
          <button 
            type="submit"
            class="w-full py-3 bg-blue-600 hover:bg-blue-700 text-white rounded-lg transition-colors font-medium"
          >
            Sign In
          </button>
        </form>
        
        <div class="mt-6 text-center">
          <p class="text-gray-600">
            Don't have an account?
            <button 
              id="goto-signup"
              class="text-blue-600 hover:underline font-medium ml-1"
            >
              Sign Up
            </button>
          </p>
        </div>

        <div class="mt-4 flex justify-center">
          <button 
            id="signin-with-google"
            class="flex items-center justify-center px-4 py-2 border border-gray-300 rounded-lg hover:bg-gray-50 w-full"
          >
            <img src="https://cdn.cdnlogo.com/logos/g/35/google-icon.svg" alt="Google" class="w-5 h-5 mr-2">
            <span>Sign in with Google</span>
          </button>
        </div>
        
        <div class="mt-6 flex justify-center">
          <button 
            id="theme-toggle-auth"
            class="p-2 rounded-full hover:bg-gray-100"
          >
            <i data-feather="moon" class="h-5 w-5 text-gray-600"></i>
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Auth Container (Sign Up) -->
  <div id="auth-signup" class="min-h-screen hidden flex items-center justify-center bg-gradient-to-br from-blue-50 to-indigo-100">
    <div classd="signup-form" class="space-y-4">
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-1">Name</label>
            <input 
              type="text" 
              name="name" 
              class="w-full px-4 py-2 rounded-lg border border-gray-300 bg-white text-gray-800 focus:outline-none focus:ring-2 focus:ring-blue-500"
              required
            />
          </div>
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-1">Email</label>
            <input 
              type="email" 
              name="email" 
              class="w-full px-4 py-2 rounded-lg border border-gray-300 bg-white text-gray-800 focus:outline-none focus:ring-2 focus:ring-blue-500"
              required
            />
          </div>
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-1">Password</label>
            <input 
              type="password" 
              name="password" 
              class="w-full px-4 py-2 rounded-lg border border-gray-300 bg-white text-gray-800 focus:outline-none focus:ring-2 focus:ring-blue-500"
              required
            />
          </div>
          <button 
            type="submit"
            class="w-full py-3 bg-blue-600 hover:bg-blue-700 text-white rounded-lg transition-colors font-medium"
          >
            Create Account
          </button>
        </form>
        
        <div class="mt-6 text-center">
          <p class="text-gray-600">
            Already have an account?
            <button 
              id="goto-signin"
              class="text-blue-600 hover:underline font-medium ml-1"
            >
              Sign In
            </button>
          </p>
        </div>

        <div class="mt-4 flex justify-center">
          <button 
            id="signup-with-google"
            class="flex items-center justify-center px-4 py-2 border border-gray-300 rounded-lg hover:bg-gray-50 w-full"
          >
            <img src="https://cdn.cdnlogo.com/logos/g/35/google-icon.svg" alt="Google" class="w-5 h-5 mr-2">
            <span>Sign up with Google</span>
          </button>
        </div>
        
        <div class="mt-6 flex justify-center">
          <button 
            id="theme-toggle-auth2"
            class="p-2 rounded-full hover:bg-gray-100"
          >
            <i data-feather="moon" class="h-5 w-5 text-gray-600"></i>
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Main App Container -->
  <div id="main-app" class="hidden flex flex-col min-h-screen">
    <!-- Header Section -->
    <header class="bg-white shadow-md">
      <div class="container mx-auto px-4">
        <nav class="flex items-center justify-between py-4">
          <a href="#" class="text-2xl font-bold text-blue-600">StudyPro</a>
          <div class="hidden md:flex space-x-6">
            <a href="#" id="nav-dashboard" class="text-blue-600 font-medium">Dashboard</a>
            <a href="#" id="nav-tests" class="hover:text-blue-600">Tests</a>
            <a href="#" class="hover:text-blue-600">Analytics</a>
            <a href="#" class="hover:text-blue-600">Resources</a>
          </div>
          <div class="flex items-center space-x-4">
            <!-- Theme Toggle -->
            <button 
              id="theme-toggle-main"
              class="p-2 rounded-full hover:bg-gray-100"
              aria-label="Toggle theme"
            >
              <i data-feather="moon" class="h-5 w-5 text-gray-600"></i>
            </button>
            
            <!-- Chatbot Toggle -->
            <button 
              id="chatbot-toggle"
              class="p-2 rounded-full hover:bg-gray-100"
              aria-label="Open chatbot"
            >
              <i data-feather="message-circle" class="h-5 w-5 text-blue-600"></i>
            </button>
            
            <!-- User Profile -->
            <div class="flex items-center space-x-3 relative group">
              <span class="hidden md:inline" id="user-name">User</span>
              <div class="w-10 h-10 rounded-full bg-blue-500 flex items-center justify-center text-white font-medium cursor-pointer">
                <span id="user-initials">U</span>
              </div>
              <div class="absolute right-0 mt-12 w-48 bg-white rounded-lg shadow-lg hidden group-hover:block p-2 border border-gray-200 z-10">
                <div class="p-3 border-b border-gray-200">
                  <p class="font-medium" id="profile-name">User</p>
                  <p class="text-sm text-gray-500" id="profile-email">user@example.com</p>
                </div>
                <button 
                  id="sign-out"
                  class="w-full text-left p-2 hover:bg-gray-100 rounded flex items-center space-x-2 text-red-600"
                >
                  <i data-feather="log-out" class="h-4 w-4"></i>
                  <span>Sign Out</span>
                </button>
              </div>
            </div>
          </div>
        </nav>
      </div>
    </header>

    <!-- Dashboard Section -->
    <section id="dashboard-section" class="flex-grow py-6">
      <div class="container mx-auto px-4">
        <div class="bg-gradient-to-r from-blue-500 to-purple-600 rounded-lg p-6 mb-8 text-white shadow-lg">
          <div class="flex flex-col md:flex-row justify-between items-start md:items-center">
            <div class="mb-4 md:mb-0">
              <h1 class="text-2xl md:text-3xl font-bold mb-2" id="dashboard-greeting">Hey User, ready to crush your goals today?</h1>
              <p class="text-lg opacity-90">You're making great progress! Keep up the momentum.</p>
            </div>
            <div class="bg-white bg-opacity-20 backdrop-blur-sm rounded-lg px-4 py-2">
              <p class="flex items-center"><span class="mr-2">🔥</span> 5-day streak! Take today's 5-min challenge.</p>
            </div>
          </div>
        </div>

        <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
          <div class="bg-white rounded-lg shadow-md p-6 hover:shadow-lg transition-shadow">
            <h3 class="text-lg font-semibold mb-3 flex items-center">
              <span class="mr-2">📅</span> Upcoming Test Date
            </h3>
            <div class="text-3xl font-bold text-blue-600 mb-1">28</div>
            <div class="text-sm text-gray-500">Days Remaining</div>
          </div>
          <div class="bg-white rounded-lg shadow-md p-6 hover:shadow-lg transition-shadow">
            <h3 class="text-lg font-semibold mb-3 flex items-center">
              <span class="mr-2">📈</span> Study Plan Progress
            </h3>
            <div class="text-3xl font-bold text-blue-600 mb-1">65%</div>
            <div class="text-sm text-gray-500">Completion Rate</div>
          </div>
          <div class="bg-white rounded-lg shadow-md p-6 hover:shadow-lg transition-shadow">
            <h3 class="text-lg font-semibold mb-3 flex items-center">
              <span class="mr-2">🎯</span> Last Practice Test Score
            </h3>
            <div class="text-3xl font-bold text-blue-600 mb-1">82%</div>
            <div class="text-sm text-gray-500">Above Average</div>
          </div>
        </div>

        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
          <div class="bg-white rounded-lg shadow-md p-6 border-l-4 border-blue-500 hover:shadow-lg transition-shadow cursor-pointer transform-scale transition-all" id="goto-test-selection">
            <div class="text-blue-500 text-3xl mb-4">✏️</div>
            <h3 class="text-xl font-semibold mb-2">Take Practice Test</h3>
            <p class="text-gray-600">Challenge yourself with a new practice test</p>
          </div>
          <div class="bg-white rounded-lg shadow-md p-6 border-l-4 border-green-500 hover:shadow-lg transition-shadow cursor-pointer transform-scale transition-all">
            <a href = "https://github.com/Sam-ctrl-prog/sat/blob/main/Study plan.html">
            <div class="text-green-500 text-3xl mb-4">📋</div>
            <h3 class="text-xl font-semibold mb-2">View Study Plan</h3>
            <p class="text-gray-600">Check your personalized study schedule</p>
          </div>
          <div class="bg-white rounded-lg shadow-md p-6 border-l-4 border-purple-500 hover:shadow-lg transition-shadow cursor-pointer transform-scale transition-all">
    <a href="https://github.com/Sam-ctrl-prog/sat/blob/main/AI%20lessons.html">
        <div class="text-purple-500 text-3xl mb-4">💡</div>
        <h3 class="text-xl font-semibold mb-2">AI generated lessons</h3>
        <p class="text-gray-600">Get personalized learning content</p>
    </a>
</div>
          <div class="bg-white rounded-lg shadow-md p-6 border-l-4 border-yellow-500 hover:shadow-lg transition-shadow cursor-pointer transform-scale transition-all">
           <a href = " https://github.com/Sam-ctrl-prog/SATPREP/blob/main/notes.html">
            <div class="text-yellow-500 text-3xl mb-4">📊</div>
            <h3 class="text-xl font-semibold mb-2">Generate Notes</h3>
            <p class="text-gray-600">Create study notes from test content</p>
           </a>
          </div>
           <div class="bg-white rounded-lg shadow-md p-6 border-l-4 border-green-500 hover:shadow-lg transition-shadow cursor-pointer transform-scale transition-all">
            <a href = "https://github.com/Sam-ctrl-prog/sat/blob/main/flashcard.html">
            <div class="text-green-500 text-3xl mb-4">📋</div>
            <h3 class="text-xl font-semibold mb-2">View Study Plan</h3>
            <p class="text-gray-600">Check your personalized study schedule</p>
            </a>
          </div>
        </div>
      </div>
    </section>

    <!-- Test Selection -->
    <section id="test-selection-section" class="hidden flex-grow py-6">
      <div class="container mx-auto px-4">
        <div class="mb-8 text-center">
          <h2 class="text-2xl md:text-3xl font-bold mb-2">Select Your Practice Test</h2>
          <p class="text-gray-600">Choose the test type and subject you want to practice</p>
        </div>

        <div class="flex flex-wrap justify-center gap-4 mb-8">
          <div class="px-6 py-4 bg-blue-600 text-white rounded-lg shadow-md cursor-pointer hover:bg-blue-700 transition-colors">
            <h3 class="text-xl font-bold mb-1">SAT</h3>
            <p class="text-sm opacity-90">College Admissions</p>
          </div>
          <div class="px-6 py-4 bg-white text-gray-800 rounded-lg shadow-md cursor-pointer hover:bg-gray-100 transition-colors">
            <h3 class="text-xl font-bold mb-1">ACT</h3>
            <p class="text-sm text-gray-600">College Admissions</p>
          </div>
          <div class="px-6 py-4 bg-white text-gray-800 rounded-lg shadow-md cursor-pointer hover:bg-gray-100 transition-colors">
            <h3 class="text-xl font-bold mb-1">AP</h3>
            <p class="text-sm text-gray-600">Advanced Placement</p>
          </div>
        </div>

        <div class="bg-white rounded-lg shadow-md p-6 mb-8">
          <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
            <div>
              <label class="block text-sm font-medium mb-2">Subject</label>
              <select id="test-subject" class="w-full p-3 bg-gray-100 rounded-lg border border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                <option>Reading</option>
                <option>Writing</option>
                <option>Math - No Calculator</option>
                <option>Math - Calculator</option>
                <option>Full Test</option>
              </select>
            </div>
            <div>
              <label class="block text-sm font-medium mb-2">Difficulty</label>
              <select id="test-difficulty" class="w-full p-3 bg-gray-100 rounded-lg border border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                <option>Easy</option>
                <option selected>Medium</option>
                <option>Hard</option>
                <option>Mixed</option>
              </select>
            </div>
          </div>

          <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <div>
              <label class="block text-sm font-medium mb-2">Mode</label>
              <div class="flex">
                <div id="timed-mode" class="flex-1 py-2 px-4 bg-blue-600 text-white text-center rounded-l-lg cursor-pointer hover:bg-blue-700 transition-colors">⏲️ Timed</div>
                <div id="untimed-mode" class="flex-1 py-2 px-4 bg-gray-100 text-center rounded-r-lg cursor-pointer hover:bg-gray-200 transition-colors">🕒 Untimed</div>
              </div>
            </div>
            <div>
              <label class="block text-sm font-medium mb-2">Question Count</label>
              <select id="question-count" class="w-full p-3 bg-gray-100 rounded-lg border border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                <option>10 Questions</option>
                <option selected>20 Questions</option>
                <option>Full Section</option>
              </select>
            </div>
          </div>
        </div>

        <div class="flex justify-between">
          <button 
            id="back-to-dashboard"
            class="px-6 py-3 bg-transparent border border-gray-300 rounded-lg hover:bg-gray-100 transition-colors"
          >
            Back to Dashboard
          </button>
          <button 
            id="start-test-btn"
            class="px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors"
          >
            Start Test
          </button>
        </div>
      </div>
    </section>

    <!-- Test Section -->
    <section id="test-section" class="hidden flex-grow py-6">
      <div class="container mx-auto px-4">
        <div class="flex items-center justify-between mb-6">
          <h2 class="text-2xl font-bold" id="test-title">SAT Practice Test - Reading</h2>
          <div class="flex items-center space-x-3">
            <div id="timer" class="hidden px-4 py-2 bg-blue-100 text-blue-800 rounded-lg">00:45:00</div>
            <button 
              id="exit-test"
              class="px-4 py-2 bg-gray-200 hover:bg-gray-300 rounded-lg text-gray-700"
            >
              Exit Test
            </button>
          </div>
        </div>

        <div class="bg-white rounded-lg shadow-md p-6 mb-6">
          <div id="progress-bar" class="w-full h-2 bg-gray-200 rounded-full mb-6">
            <div class="h-2 bg-blue-600 rounded-full" style="width: 5%;"></div>
          </div>
          
          <div id="question-container">
            <div class="mb-4">
              <p id="question-number" class="text-sm text-gray-500 mb-2">Question 1 of 20</p>
              <p id="question-text" class="text-lg font-medium mb-6">Loading question...</p>
            </div>
            
            <div id="options-container" class="space-y-3">
              <!-- Options will be added here dynamically -->
              <div class="animate-pulse">
                <div class="h-8 bg-gray-200 rounded w-full mb-3"></div>
                <div class="h-8 bg-gray-200 rounded w-full mb-3"></div>
                <div class="h-8 bg-gray-200 rounded w-full mb-3"></div>
                <div class="h-8 bg-gray-200 rounded w-full"></div>
              </div>
            </div>
          </div>
        </div>

        <div class="flex justify-between">
          <button 
            id="prev-question"
            class="px-6 py-3 bg-transparent border border-gray-300 rounded-lg hover:bg-gray-100 transition-colors disabled:opacity-50 disabled:cursor-not-allowed"
            disabled
          >
            Previous
          </button>
          <button 
            id="next-question"
            class="px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors"
          >
            Next
          </button>
        </div>
      </div>
    </section>

    <!-- Footer -->
    <footer class="bg-white py-4 shadow-md mt-auto">
      <div class="container mx-auto px-4 text-center text-gray-600 text-sm">
        <p>© 2025 StudyPro. All rights reserved.</p>
      </div>
    </footer>
  </div>

  <!-- Chatbot -->
  <div id="chatbot" class="fixed bottom-20 right-6 w-80 h-96 bg-white rounded-lg shadow-xl flex flex-col overflow-hidden z-50 border border-gray-200 hidden">
    <div class="bg-blue-600 text-white px-4 py-3 flex justify-between items-center">
      <h3 class="font-medium">StudyPro AI Assistant</h3>
      <button id="close-chatbot" class="text-white hover:text-gray-200">
        ×
      </button>
    </div>
    
    <div class="flex-1 p-4 overflow-y-auto" id="chat-messages">
      <div class="mb-3 text-left chat-message">
        <div class="inline-block px-4 py-2 rounded-lg bg-gray-100 text-gray-800">
          Hi there! I'm your StudyPro AI assistant. How can I help you today?
        </div>
      </div>
    </div>
    
    <form id="chat-form" class="border-t border-gray-200 p-3 flex">
      <input
        type="text"
        id="chat-input"
        placeholder="Type your message..."
        class="flex-1 bg-gray-100 border-none rounded-l-lg px-3 py-2 text-gray-800 focus:outline-none"
      />
      <button 
        type="submit"
        class="bg-blue-600 text-white px-4 py-2 rounded-r-lg hover:bg-blue-700"
      >
        Send
      </button>
    </form>
  </div>

  <script>
    // Firebase configuration
    const firebaseConfig = {
      apiKey: "YOUR_API_KEY",
      authDomain: "studypro-app.firebaseapp.com",
      projectId: "studypro-app",
      storageBucket: "studypro-app.appspot.com",
      messagingSenderId: "YOUR_MESSAGING_SENDER_ID",
      appId: "YOUR_APP_ID"
    };

    // OpenAI API configuration
    const OPENAI_API_KEY = "YOUR_OPENAI_API_KEY";

    // Initialize Firebase
    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.firestore();

    // Initialize Feather icons
    document.addEventListener('DOMContentLoaded', function() {
      feather.replace();
      
      // DOM elements
      const authSignin = document.getElementById('auth-signin');
      const authSignup = document.getElementById('auth-signup');
      const mainApp = document.getElementById('main-app');
      const dashboardSection = document.getElementById('dashboard-section');
      const testSelectionSection = document.getElementById('test-selection-section');
      const testSection = document.getElementById('test-section');
      const chatbot = document.getElementById('chatbot');
      
      // Auth state observer
      auth.onAuthStateChanged(user => {
        if (user) {
          // User is signed in
          showMainApp(user);
        } else {
          // User is signed out
          showAuthScreen();
        }
      });
      
      // Switch between auth screens
      document.getElementById('goto-signup').addEventListener('click', function() {
        authSignin.classList.add('hidden');
        authSignup.classList.remove('hidden');
      });
      
      document.getElementById('goto-signin').addEventListener('click', function() {
        authSignup.classList.add('hidden');
        authSignin.classList.remove('hidden');
      });
      
      // Handle sign in
      document.getElementById('signin-form').addEventListener('submit', function(e) {
        e.preventDefault();
        
        const email = e.target.elements.email.value;
        const password = e.target.elements.password.value;
        const errorElement = document.getElementById('auth-error');
        
        auth.signInWithEmailAndPassword(email, password)
          .catch(error => {
            // Display error message
            errorElement.textContent = error.message;
            errorElement.classList.remove('hidden');
          });
      });
      
      // Handle sign up
      document.getElementById('signup-form').addEventListener('submit', function(e) {
        e.preventDefault();
        
        const name = e.target.elements.name.value;
        const email = e.target.elements.email.value;
        const password = e.target.elements.password.value;
        const errorElement = document.getElementById('signup-error');
        
        auth.createUserWithEmailAndPassword(email, password)
          .then(userCredential => {
            // Add user to Firestore database
            return db.collection('users').doc(userCredential.user.uid).set({
              name: name,
              email: email,
              createdAt: firebase.firestore.FieldValue.serverTimestamp()
            });
          })
          .catch(error => {
            // Display error message
            errorElement.textContent = error.message;
            errorElement.classList.remove('hidden');
          });
      });
      
      // Google Sign-in
      document.getElementById('signin-with-google').addEventListener('click', function() {
        const provider = new firebase.auth.GoogleAuthProvider();
        auth.signInWithPopup(provider).catch(error => {
          const errorElement = document.getElementById('auth-error');
          errorElement.textContent = error.message;
          errorElement.classList.remove('hidden');
        });
      });
      
      document.getElementById('signup-with-google').addEventListener('click', function() {
        const provider = new firebase.auth.GoogleAuthProvider();
        auth.signInWithPopup(provider).catch(error => {
          const errorElement = document.getElementById('signup-error');
          errorElement.textContent = error.message;
          errorElement.classList.remove('hidden');
        });
      });
      
      // Handle sign out
      // Handle sign out
      document.getElementById('sign-out').addEventListener('click', function() {
        auth.signOut().catch(error => {
          console.error("Error signing out: ", error);
        });
      });
      
      // Theme toggling
      const toggleTheme = () => {
        document.body.classList.toggle('dark');
        const isDark = document.body.classList.contains('dark');
        
        // Update icon for all theme toggles
        document.querySelectorAll('[id^="theme-toggle"]').forEach(button => {
          const icon = button.querySelector('i');
          if (isDark) {
            icon.setAttribute('data-feather', 'sun');
          } else {
            icon.setAttribute('data-feather', 'moon');
          }
          feather.replace();
        });
      };
      
      document.querySelectorAll('[id^="theme-toggle"]').forEach(button => {
        button.addEventListener('click', toggleTheme);
      });
      
      // Navigation
      document.getElementById('nav-dashboard').addEventListener('click', function(e) {
        e.preventDefault();
        showDashboard();
      });
      
      document.getElementById('nav-tests').addEventListener('click', function(e) {
        e.preventDefault();
        showTestSelection();
      });
      
      document.getElementById('goto-test-selection').addEventListener('click', function() {
        showTestSelection();
      });
      
      document.getElementById('back-to-dashboard').addEventListener('click', function() {
        showDashboard();
      });
      
      document.getElementById('start-test-btn').addEventListener('click', function() {
        startTest();
      });
      
      document.getElementById('exit-test').addEventListener('click', function() {
        confirmExitTest();
      });
      
      // Chatbot toggling
      document.getElementById('chatbot-toggle').addEventListener('click', function() {
        chatbot.classList.toggle('hidden');
      });
      
      document.getElementById('close-chatbot').addEventListener('click', function() {
        chatbot.classList.add('hidden');
      });
      
      // Chat form submission
      document.getElementById('chat-form').addEventListener('submit', function(e) {
        e.preventDefault();
        const input = document.getElementById('chat-input');
        const message = input.value.trim();
        
        if (message) {
          addChatMessage(message, 'user');
          input.value = '';
          processUserMessage(message);
        }
      });
      
      // Test interactions
      document.getElementById('next-question').addEventListener('click', function() {
        handleNextQuestion();
      });
      
      document.getElementById('prev-question').addEventListener('click', function() {
        handlePrevQuestion();
      });
      
      document.getElementById('timed-mode').addEventListener('click', function() {
        setTestMode('timed');
      });
      
      document.getElementById('untimed-mode').addEventListener('click', function() {
        setTestMode('untimed');
      });
      
      // Helper functions
      function showAuthScreen() {
        authSignin.classList.remove('hidden');
        authSignup.classList.add('hidden');
        mainApp.classList.add('hidden');
      }
      
      function showMainApp(user) {
        authSignin.classList.add('hidden');
        authSignup.classList.add('hidden');
        mainApp.classList.remove('hidden');
        
        // Update UI with user info
        document.getElementById('user-name').textContent = user.displayName || user.email.split('@')[0];
        document.getElementById('user-initials').textContent = (user.displayName || user.email)[0].toUpperCase();
        document.getElementById('dashboard-greeting').textContent = `Hey ${user.displayName || user.email.split('@')[0]}, ready to crush your goals today?`;
        document.getElementById('profile-name').textContent = user.displayName || user.email.split('@')[0];
        document.getElementById('profile-email').textContent = user.email;
        
        // By default, show dashboard
        showDashboard();
        
        // Fetch user data from Firestore
        db.collection('users').doc(user.uid).get()
          .then(doc => {
            if (doc.exists) {
              const userData = doc.data();
              // Additional user data processing here
            }
          })
          .catch(error => {
            console.error("Error getting user data: ", error);
          });
      }
      
      function showDashboard() {
        dashboardSection.classList.remove('hidden');
        testSelectionSection.classList.add('hidden');
        testSection.classList.add('hidden');
      }
      
      function showTestSelection() {
        dashboardSection.classList.add('hidden');
        testSelectionSection.classList.remove('hidden');
        testSection.classList.add('hidden');
      }
      
      function setTestMode(mode) {
        if (mode === 'timed') {
          document.getElementById('timed-mode').classList.add('bg-blue-600', 'text-white');
          document.getElementById('timed-mode').classList.remove('bg-gray-100');
          document.getElementById('untimed-mode').classList.add('bg-gray-100');
          document.getElementById('untimed-mode').classList.remove('bg-blue-600', 'text-white');
        } else {
          document.getElementById('untimed-mode').classList.add('bg-blue-600', 'text-white');
          document.getElementById('untimed-mode').classList.remove('bg-gray-100');
          document.getElementById('timed-mode').classList.add('bg-gray-100');
          document.getElementById('timed-mode').classList.remove('bg-blue-600', 'text-white');
        }
      }
      
      // Test functionality
      let currentTestData = {
        currentQuestionIndex: 0,
        questions: [],
        userAnswers: [],
        startTime: null,
        timerInterval: null,
        testType: '',
        testSubject: '',
        difficulty: '',
        questionCount: 0,
        isTimedMode: true
      };
      
      function startTest() {
        // Gather test parameters
        currentTestData.testType = 'SAT'; // Hardcoded for now, but could be made dynamic
        currentTestData.testSubject = document.getElementById('test-subject').value;
        currentTestData.difficulty = document.getElementById('test-difficulty').value;
        currentTestData.questionCount = parseInt(document.getElementById('question-count').value);
        currentTestData.isTimedMode = document.getElementById('timed-mode').classList.contains('bg-blue-600');
        
        // Reset test state
        currentTestData.currentQuestionIndex = 0;
        currentTestData.userAnswers = [];
        currentTestData.startTime = new Date();
        
        // Update UI
        document.getElementById('test-title').textContent = `${currentTestData.testType} Practice Test - ${currentTestData.testSubject}`;
        
        // Show test section
        dashboardSection.classList.add('hidden');
        testSelectionSection.classList.add('hidden');
        testSection.classList.remove('hidden');
        
        // Set up timer if in timed mode
        if (currentTestData.isTimedMode) {
          const timerElement = document.getElementById('timer');
          timerElement.classList.remove('hidden');
          
          // Set timer based on test subject and length
          let timeInMinutes = 25; // Default
          if (currentTestData.testSubject === 'Reading') timeInMinutes = 65;
          else if (currentTestData.testSubject === 'Writing') timeInMinutes = 35;
          else if (currentTestData.testSubject.includes('Math')) timeInMinutes = 25;
          else if (currentTestData.testSubject === 'Full Test') timeInMinutes = 180;
          
          // Adjust based on question count
          if (currentTestData.questionCount === 10) timeInMinutes = Math.round(timeInMinutes * 0.5);
          else if (currentTestData.questionCount === 20) timeInMinutes = Math.round(timeInMinutes * 0.75);
          
          startTimer(timeInMinutes);
        } else {
          document.getElementById('timer').classList.add('hidden');
        }
        
        // Generate questions using OpenAI
        generateTestQuestions();
      }
      
      function startTimer(minutes) {
        let totalSeconds = minutes * 60;
        const timerElement = document.getElementById('timer');
        
        updateTimerDisplay(totalSeconds);
        
        if (currentTestData.timerInterval) {
          clearInterval(currentTestData.timerInterval);
        }
        
        currentTestData.timerInterval = setInterval(() => {
          totalSeconds--;
          updateTimerDisplay(totalSeconds);
          
          if (totalSeconds <= 0) {
            clearInterval(currentTestData.timerInterval);
            alert('Time is up! Your test will be submitted automatically.');
            completeTest();
          }
        }, 1000);
      }
      
      function updateTimerDisplay(totalSeconds) {
        const hours = Math.floor(totalSeconds / 3600);
        const minutes = Math.floor((totalSeconds % 3600) / 60);
        const seconds = totalSeconds % 60;
        
        const display = `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
        document.getElementById('timer').textContent = display;
      }
      
      function confirmExitTest() {
        if (confirm('Are you sure you want to exit the test? Your progress will be lost.')) {
          if (currentTestData.timerInterval) {
            clearInterval(currentTestData.timerInterval);
          }
          showDashboard();
        }
      }
      
      async function generateTestQuestions() {
        const loadingOptions = `
          <div class="animate-pulse">
            <div class="h-8 bg-gray-200 rounded w-full mb-3"></div>
            <div class="h-8 bg-gray-200 rounded w-full mb-3"></div>
            <div class="h-8 bg-gray-200 rounded w-full mb-3"></div>
            <div class="h-8 bg-gray-200 rounded w-full"></div>
          </div>
        `;
        document.getElementById('options-container').innerHTML = loadingOptions;
        document.getElementById('question-text').textContent = 'Generating your questions...';
        
        try {
          // Determine how many questions to generate based on selection
          let questionCount = 10;
          if (document.getElementById('question-count').value.includes('20')) {
            questionCount = 20;
          } else if (document.getElementById('question-count').value.includes('Full')) {
            questionCount = 30;
          }
          
          const subject = document.getElementById('test-subject').value;
          const difficulty = document.getElementById('test-difficulty').value;
          
          // Call OpenAI API to generate test questions
          const response = await fetch('https://api.openai.com/v1/chat/completions', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
              'Authorization': `Bearer ${OPENAI_API_KEY}`
            },
            body: JSON.stringify({
              model: "gpt-4",
              messages: [
                {
                  role: "system",
                  content: `You are an expert test creator for standardized tests. Generate ${questionCount} multiple-choice ${subject} questions for the SAT at ${difficulty} difficulty level. Each question should have 4 options (A, B, C, D), with one correct answer. Format as a JSON array of objects with the following structure: [{"question": "Question text", "options": ["A. Option 1", "B. Option 2", "C. Option 3", "D. Option 4"], "correctAnswer": "A", "explanation": "Brief explanation of the correct answer"}]`
                },
                {
                  role: "user",
                  content: `Generate ${questionCount} ${difficulty} ${subject} questions for an SAT practice test.`
                }
              ],
              temperature: 0.7
            })
          });
          
          const data = await response.json();
          
          if (data.choices && data.choices[0] && data.choices[0].message) {
            try {
              // Extract JSON from the response
              const contentText = data.choices[0].message.content;
              const jsonMatch = contentText.match(/\[[\s\S]*\]/);
              const jsonString = jsonMatch ? jsonMatch[0] : contentText;
              
              currentTestData.questions = JSON.parse(jsonString);
              
              // Initialize user answers array
              currentTestData.userAnswers = new Array(currentTestData.questions.length).fill(null);
              
              // Display first question
              displayQuestion(0);
            } catch (jsonError) {
              console.error("Error parsing question JSON:", jsonError);
              alert("There was an error generating your test questions. Please try again.");
              showTestSelection();
            }
          } else {
            throw new Error("Unexpected API response format");
          }
        } catch (error) {
          console.error("Error generating questions:", error);
          alert("There was an error generating your test questions. Please try again.");
          showTestSelection();
        }
      }
      
      function displayQuestion(index) {
        const question = currentTestData.questions[index];
        const questionNumberEl = document.getElementById('question-number');
        const questionTextEl = document.getElementById('question-text');
        const optionsContainerEl = document.getElementById('options-container');
        const progressBarEl = document.querySelector('#progress-bar > div');
        
        // Update question number and text
        questionNumberEl.textContent = `Question ${index + 1} of ${currentTestData.questions.length}`;
        questionTextEl.textContent = question.question;
        
        // Update progress bar
        const progressPercentage = ((index + 1) / currentTestData.questions.length) * 100;
        progressBarEl.style.width = `${progressPercentage}%`;
        
        // Generate options
        let optionsHTML = '';
        question.options.forEach((option, optionIndex) => {
          const optionLetter = option.split('.')[0];
          const isSelected = currentTestData.userAnswers[index] === optionLetter;
          optionsHTML += `
            <div class="option-container ${isSelected ? 'bg-blue-100 border-blue-300' : ''} border rounded-lg p-3 cursor-pointer hover:bg-gray-100" data-option="${optionLetter}">
              ${option}
            </div>
          `;
        });
        
        optionsContainerEl.innerHTML = optionsHTML;
        
        // Add click event listeners to options
        document.querySelectorAll('.option-container').forEach(optionEl => {
          optionEl.addEventListener('click', function() {
            const selectedOption = this.getAttribute('data-option');
            selectOption(index, selectedOption);
          });
        });
        
        // Update navigation buttons
        document.getElementById('prev-question').disabled = index === 0;
        const nextButton = document.getElementById('next-question');
        
        if (index === currentTestData.questions.length - 1) {
          nextButton.textContent = 'Finish Test';
        } else {
          nextButton.textContent = 'Next';
        }
      }
      
      function selectOption(questionIndex, optionLetter) {
        // Save user's answer
        currentTestData.userAnswers[questionIndex] = optionLetter;
        
        // Update UI to show selected option
        document.querySelectorAll('.option-container').forEach(optionEl => {
          if (optionEl.getAttribute('data-option') === optionLetter) {
            optionEl.classList.add('bg-blue-100', 'border-blue-300');
          } else {
            optionEl.classList.remove('bg-blue-100', 'border-blue-300');
          }
        });
      }
      
      function handleNextQuestion() {
        if (currentTestData.currentQuestionIndex === currentTestData.questions.length - 1) {
          completeTest();
          return;
        }
        
        currentTestData.currentQuestionIndex++;
        displayQuestion(currentTestData.currentQuestionIndex);
      }
      
      function handlePrevQuestion() {
        if (currentTestData.currentQuestionIndex > 0) {
          currentTestData.currentQuestionIndex--;
          displayQuestion(currentTestData.currentQuestionIndex);
        }
      }
      
      function completeTest() {
        // Stop timer if running
        if (currentTestData.timerInterval) {
          clearInterval(currentTestData.timerInterval);
        }
        
        // Calculate score
        let correctAnswers = 0;
        
        currentTestData.questions.forEach((question, index) => {
          if (currentTestData.userAnswers[index] === question.correctAnswer) {
            correctAnswers++;
          }
        });
        
        const scorePercentage = Math.round((correctAnswers / currentTestData.questions.length) * 100);
        
        // Save test results to Firebase
        const user = auth.currentUser;
        if (user) {
          db.collection('users').doc(user.uid)
            .collection('testResults')
            .add({
              testType: currentTestData.testType,
              subject: currentTestData.testSubject,
              difficulty: currentTestData.difficulty,
              score: scorePercentage,
              correctAnswers: correctAnswers,
              totalQuestions: currentTestData.questions.length,
              completedAt: firebase.firestore.FieldValue.serverTimestamp(),
              timeSpent: Math.floor((new Date() - currentTestData.startTime) / 1000)
            })
            .then(() => {
              console.log("Test result saved successfully");
            })
            .catch(error => {
              console.error("Error saving test result:", error);
            });
        }
        
        // Display results
        const testContainer = document.getElementById('question-container');
        testContainer.innerHTML = `
          <div class="text-center py-8">
            <div class="text-5xl font-bold mb-4">${scorePercentage}%</div>
            <p class="text-xl mb-6">You got ${correctAnswers} out of ${currentTestData.questions.length} questions correct</p>
            
            <div class="mb-6">
              <div class="w-full bg-gray-200 rounded-full h-4 mb-2">
                <div class="bg-blue-600 h-4 rounded-full" style="width: ${scorePercentage}%"></div>
              </div>
              <div class="flex justify-between text-sm text-gray-600">
                <span>0%</span>
                <span>50%</span>
                <span>100%</span>
              </div>
            </div>
            
            <div class="mt-8 mb-4 space-y-4">
              <button id="view-results" class="px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors w-full md:w-auto">
                View Detailed Results
              </button>
              <button id="take-another-test" class="px-6 py-3 bg-white border border-gray-300 rounded-lg hover:bg-gray-100 transition-colors w-full md:w-auto">
                Take Another Test
              </button>
            </div>
            
            <div class="mt-4 px-6 py-4 bg-blue-50 rounded-lg text-left">
              <p class="text-blue-800 font-medium mb-2">Need help understanding your results?</p>
              <p>Click the chat button to discuss your performance with our AI tutor.</p>
            </div>
          </div>
        `;
        
        // Add event listeners for the result buttons
        document.getElementById('view-results').addEventListener('click', function() {
          displayTestReview();
        });
        
        document.getElementById('take-another-test').addEventListener('click', function() {
          showTestSelection();
        });
      }
      
      function displayTestReview() {
        const testContainer = document.getElementById('question-container');
        let reviewHTML = `
          <div class="mb-6">
            <h3 class="text-xl font-bold mb-4">Question Review</h3>
            <div class="space-y-8">
        `;
        
        currentTestData.questions.forEach((question, index) => {
          const userAnswer = currentTestData.userAnswers[index];
          const isCorrect = userAnswer === question.correctAnswer;
          
          reviewHTML += `
            <div class="p-4 rounded-lg ${isCorrect ? 'bg-green-50 border border-green-200' : 'bg-red-50 border border-red-200'}">
              <p class="font-medium mb-2">Question ${index + 1}: ${question.question}</p>
              <div class="ml-4 mb-3">
          `;
          
          question.options.forEach(option => {
            const optionLetter = option.split('.')[0];
            let optionClass = '';
            
            if (optionLetter === question.correctAnswer) {
              optionClass = 'text-green-700 font-medium';
            } else if (optionLetter === userAnswer && userAnswer !== question.correctAnswer) {
              optionClass = 'text-red-700 line-through';
            }
            
            reviewHTML += `<p class="${optionClass}">${option}</p>`;
          });
          
          reviewHTML += `
              </div>
              <div class="bg-white p-3 rounded border border-gray-200">
                <p class="text-sm font-medium mb-1">Explanation:</p>
                <p class="text-sm">${question.explanation}</p>
              </div>
            </div>
          `;
        });
        
        reviewHTML += `
            </div>
          </div>
          <div class="flex justify-between mt-6">
            <button id="back-to-results" class="px-6 py-3 bg-white border border-gray-300 rounded-lg hover:bg-gray-100 transition-colors">
              Back to Results
            </button>
            <button id="review-to-dashboard" class="px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors">
              Return to Dashboard
            </button>
          </div>
        `;
        
        testContainer.innerHTML = reviewHTML;
        
        // Add event listeners
        document.getElementById('back-to-results').addEventListener('click', function() {
          completeTest();
        });
        
        document.getElementById('review-to-dashboard').addEventListener('click', function() {
          showDashboard();
        });
      }
      
      // Chatbot functionality
      function addChatMessage(message, sender) {
        const chatMessages = document.getElementById('chat-messages');
        const messageDiv = document.createElement('div');
        
        messageDiv.className = `mb-3 text-${sender === 'user' ? 'right' : 'left'} chat-message`;
        messageDiv.innerHTML = `
          <div class="inline-block px-4 py-2 rounded-lg ${
            sender === 'user' 
              ? 'bg-blue-600 text-white' 
              : 'bg-gray-100 text-gray-800'
          }">
            ${message}
          </div>
        `;
        
        chatMessages.appendChild(messageDiv);
        chatMessages.scrollTop = chatMessages.scrollHeight;
      }
      
      function addLoadingMessage() {
        const chatMessages = document.getElementById('chat-messages');
        const loadingDiv = document.createElement('div');
        
        loadingDiv.className = 'mb-3 text-left chat-message loading-message';
        loadingDiv.innerHTML = `
          <div class="inline-block px-4 py-2 rounded-lg bg-gray-100 text-gray-800">
            <span class="loading-dots">Thinking</span>
          </div>
        `;
        
        chatMessages.appendChild(loadingDiv);
        chatMessages.scrollTop = chatMessages.scrollHeight;
        
        return loadingDiv;
      }
      
      async function processUserMessage(message) {
        // Add loading indicator
        const loadingMessage = addLoadingMessage();
        
        try {
          // Get user context
          const user = auth.currentUser;
          let userContext = '';
          
          if (user) {
            const userDoc = await db.collection('users').doc(user.uid).get();
            if (userDoc.exists) {
              const userData = userDoc.data();
              userContext = `User's name: ${userData.name || user.displayName || 'Student'}`;
              
              // Get recent test results
              const testResults = await db.collection('users').doc(user.uid)
                .collection('testResults')
                .orderBy('completedAt', 'desc')
                .limit(3)
                .get();
                
              if (!testResults.empty) {
                userContext += '. Recent test results: ';
                testResults.forEach(doc => {
                  const result = doc.data();
                  userContext += `${result.testType} ${result.subject}: ${result.score}%, `;
                });
              }
            }
          }
          
          // Call OpenAI API for chatbot response
          const response = await fetch('https://api.openai.com/v1/chat/completions', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
              'Authorization': `Bearer ${OPENAI_API_KEY}`
            },
            body: JSON.stringify({
              model: "gpt-3.5-turbo",
              messages: [
                {
                  role: "system",
                  content: `You are StudyPro AI, a helpful and encouraging study assistant for standardized test preparation. ${userContext}`
                },
                {
                  role: "user",
                  content: message
                }
              ],
              temperature: 0.7
            })
          });
          
          const data = await response.json();
          
          // Remove loading message
          if (loadingMessage) {
            loadingMessage.remove();
          }
          
          if (data.choices && data.choices[0] && data.choices[0].message) {
            const aiResponse = data.choices[0].message.content;
            addChatMessage(aiResponse, 'ai');
          } else {
            throw new Error("Unexpected API response format");
          }
        } catch (error) {
          console.error("Error getting AI response:", error);
          
          // Remove loading message
          if (loadingMessage) {
            loadingMessage.remove();
          }
          
          addChatMessage("Sorry, I'm having trouble connecting right now. Please try again later.", 'ai');
        }
      }
    });
  </script>
</body>
</html>
